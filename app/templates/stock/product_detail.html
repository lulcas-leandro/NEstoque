{% extends "base.html" %}

{% block content %}
    <h1>{{ product.name }} (SKU: {{ product.sku }})</h1>
    <p><strong>Descrição:</strong> {{ product.description or 'N/A' }}</p>
    <p><strong>Quantidade em Estoque:</strong> {{ product.quantity }}</p>
    <a href="{{ url_for('stock.list_products') }}">Voltar para a lista</a>

    <hr>

    <h2>Registrar Movimentação</h2>
    <form action="{{ url_for('stock.move_stock', product_id=product.id) }}" method="post" novalidate>
        {{ form.hidden_tag() }}
        <p>
            {{ form.quantity.label }}: {{ form.quantity(size=10) }}
            {% for error in form.quantity.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}
        </p>
        <p>
            {{ form.notes.label }}:<br>
            {{ form.notes(cols=40, rows=3) }}
        </p>
        <p>
            {{ form.submit_in() }}
            {{ form.submit_out() }}
        </p>
    </form>

    <hr>

    <h2>Histórico de Movimentações</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Quantidade</th>
                <th>Usuário</th>
                <th>Observações</th>
            </tr>
        </thead>
        <tbody>
            {% for movement in movements %}
            <tr>
                <td>{{ movement.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ movement.movement_type }}</td>
                <td>{{ movement.quantity }}</td>
                <td>{{ movement.user.username }}</td>
                <td>{{ movement.notes }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">Nenhuma movimentação registrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}